@using NIMBOLE.UI.Helpers
@{
    ViewBag.Title = "Home Page";
    var culture = System.Globalization.CultureInfo.CurrentCulture.ToString();
    Layout = "~/Views/Shared/_Layout.cshtml";
}


@section scripts {
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="@Url.Content("~/Scripts/jquery.signalR-2.2.0.min.js")"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="@Url.Content("~/signalr/hubs")"></script>
    <link href="@Url.Content("~/assets/js/plugins/fullcalendar/fullcalendar.min.css")" rel="stylesheet" />

    <script src="@Url.Content("~/assets/js/plugins/fullcalendar/moment.min.js")"></script>

    <script src="@Url.Content("~/assets/js/plugins/fullcalendar/fullcalendar.min.js")"></script>

    <script src="@Url.Content("~/assets/js/plugins/fullcalendar/gcal.min.js")"></script>
    <script src="@Url.Content("~/assets/js/plugins/fullcalendar/moment.min.js")"></script>

    <!--SignalR script to update the chat page and send messages.-->
    <script>
        var eventsarray = [];
        var events = [];
        $(document).ready(function () {
            $.ajax({
                url: "/SchEmpTskAct/Scheduler_Read",
                type: 'POST',
                async: false,
                data: {},
                success: function (doc) {
                    events.push(doc);
                    var len = events[0].Data.length;
                    for (var i = 0; i < len; i++) {
                        var sdate = events[0].Data[i].mstart;
                        var dt = new Date(sdate);
                        var year = dt.getFullYear();
                        var month = dt.getMonth();
                        var date = dt.getDate();

                        var edate = events[0].Data[i].mend;
                        var dt1 = new Date(edate);
                        var year1 = dt1.getFullYear();
                        var month1 = dt1.getMonth();
                        var date1 = dt1.getDate();

                        eventsarray.push({
                            title: events[0].Data[i].Title,
                            start: new Date(year, month, date),
                            end: new Date(year1, month1, date1),

                            allDay: false,
                            color: events[0].Data[i].IsActivity ? '#0187cb' : '#90EE90'
                        });
                    }
                }
            });
        });
        $(function () {
            // Reference the auto-generated proxy for the hub.
            var proxy = $.connection.nimboleHub;
            // Start the connection.
            $.connection.hub.start().done(function () {
                @*var empId = '@Session["EmployeeId"] != "" || @Session["EmployeeId"] != null ? @Session["EmployeeId"].ToString():0';*@
                var empId = '@Session["EmployeeId"]';
                proxy.server.bindValues(empId).done(function (data) {
                    $('#divLeads').text(data[0]);
                    $('#divTasks').text(data[2]);
                    $('#divOpp').text(data[1]);
                });
            });
            proxy.client.update = function (data) {
                $('#divLeads').text(data[0]);
                $('#divTasks').text(data[2]);
                $('#divOpp').text(data[1]);
            };
        });
        //kendo.culture("es-ES");
    </script>
}


<!-- Main Container -->
<main id="main-container" style="padding-top:0px;">
    <!-- Stats -->

    <div class="row" style="margin-top:5%">
        <div class="col-xs-12">

            <div class="col-lg-4">
                <!-- Lead Center Widget -->
                <div class="block block-bordered">

                    <div class="block-content">
                        <div class="pull-r-l pull-t push">
                            <table class="block-table text-center bg-gray-lighter border-b">
                                <tbody>
                                    <tr>
                                        <td class="border-r">
                                            <div id="divLeads" class="h1 font-w700">@ViewBag.NoOfLeads</div>
                                            <div class="h5 text-muted text-uppercase push-5-t">Today's Leads</div>
                                        </td>

                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="list-group">
                            <a class="list-group-item active" href="@Url.EncodeActionUrl("Index", "Leads", new { resHome = "2" }, null)">
                                <span class="badge"><i class="fa fa-arrow-circle-right"></i></span>
                                <i class="fa fa-fw fa-inbox push-5-r"></i> View Leads
                            </a>
                        </div>
                    </div>
                </div>
                <!-- END Lead Center Widget -->
            </div>

            <div class="col-lg-4">
                <!-- Opportunity Widget -->
                <div class=" block block-bordered">

                    <div class="block-content">
                        <div class="pull-r-l pull-t push">
                            <table class="block-table text-center bg-gray-lighter border-b">
                                <tbody>
                                    <tr>
                                        <td class="border-r">
                                            <div id="divOpp" class="h1 font-w700">@ViewBag.NoOfOpportunities</div>
                                            <div class="h5 text-muted text-uppercase push-5-t"> Today's Opportunities</div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="list-group">
                            <a class="list-group-item active" href="@Url.EncodeActionUrl("Index", "Leads", new { resHome = "3" }, null)">
                                <span class="badge"><i class="fa fa-arrow-circle-right"></i></span>
                                <i class="fa fa-fw fa-inbox push-5-r"></i> View Opportunities
                            </a>
                        </div>

                    </div>
                </div>
                <!-- END Opportunity Widget -->
            </div>

            <div class="col-lg-4">
                <!-- Deal Widget -->

                <div class=" block block-bordered">

                    <div class="block-content">
                        <div class="pull-r-l pull-t push">
                            <table class="block-table text-center bg-gray-lighter border-b">
                                <tbody>
                                    <tr>
                                        <td class="border-r">
                                            <div id="divTasks" class="h1 font-w700">@ViewBag.NoOfTasks</div>
                                            <div class="h5 text-muted text-uppercase push-5-t">Today's Deals</div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="list-group">
                            <a class="list-group-item active" href="@Url.EncodeActionUrl("Index", "Leads", new { resHome = "4" }, null)">
                                <span class="badge"><i class="fa fa-arrow-circle-right"></i></span>
                                <i class="fa fa-fw fa-inbox push-5-r"></i> View Deals
                            </a>
                        </div>
                    </div>
                    <!-- END Opportunity Widget -->
                </div>

            </div>
        </div>
    </div>
    <!-- Calendar -->

    <div class="col-xs-12">
        <!-- Calendar Container -->
        <div class="js-calendar"></div>
    </div>


    <!-- END Calendar -->
</main>

<!-- END Main Container -->
<!-- Footer -->
@*<footer id="page-footer" class="content-mini content-mini-full font-s12 bg-gray-lighter clearfix">
        <div class="pull-right">
            @*Crafted with <i class="fa fa-heart text-city"></i> by <a class="font-w600" href="http://goo.gl/vNS3I" target="_blank">pixelcave</a>
        </div>
        <div class="pull-left">
            <a class="font-w600" href="http://goo.gl/6LF10W" target="_blank">NIMBOLE</a> &copy; <span class="js-year-copy"></span>
        </div>
    </footer>*@
<!-- END Footer -->
@*//custom customAlert*@

<script>
    var empId = '@Session["EmployeeId"]';
    function scheduler_add(e) {
        //e.preventDefault();
        //alert("You can't Add Activity or Task from here.");
    }
    function scheduler_dataBound(e) {
        e.sender._data.forEach(function (eventDetails) {
            if (!eventDetails['IsActivity']) {
                $('div.k-event[data-uid="' + eventDetails['uid'] + '"]').addClass('special-event')
            }
        });
    }
    function scheduler_remove(e) {
        if (e.event.IsActivity) {
            e.preventDefault();
            customAlert("You can't delete.", "");
        }
        else if (e.event.EmpId != empId) {
            e.preventDefault();
            customAlert("You can't delete.", "");
        }

    }
    function scheduler_edit(e) {
        if (e.event["title"] != "") {
            if (e.event["IsActivity"]) {
                e.preventDefault();
                // alert("You can't edit activity from here.");
                customAlert("You can't edit activity from here.", "");
            }
            else {

                if (e.event.EmpId === empId) {
                    $(".k-window-title").text("Task");
                    $('#Title').val(e.event.title);
                    $('#Description').val(e.event.description);
                    $('#Start').val(formatDate(e.event.start));
                    $('#End').val(formatDate(e.event.end));
                }
                else {
                    e.preventDefault();
                    // alert("You can't edit.");
                    customAlert("You can't edit.", "");
                }
            }
        }
        else {
            e.preventDefault();
        }
    }
    function formatDate(date) {
        var hours = date.getHours();
        var minutes = date.getMinutes();
        var ampm = hours >= 12 ? 'pm' : 'am';
        hours = hours % 12;
        hours = hours ? hours : 12; // the hour '0' should be '12'
        minutes = minutes < 10 ? '0' + minutes : minutes;
        var strTime = hours + ':' + minutes + ' ' + ampm;
        //return date.getMonth() + 1 + "/" + date.getDate() + "/" + date.getFullYear() + "  " + strTime;
        return date.getMonth() + 1 + "/" + date.getDate() + "/" + date.getFullYear();
    }
</script>

 <script>
    /*
*  Document   : base_comp_calendar.js
*  Author     : pixelcave
*  Description: Custom JS code used in Calendar Page
*/

    var BaseCompCalendar = function () {
        // Add new event in the event list
        var addEvent = function () {
            var $eventInput = jQuery('.js-add-event');
            var $eventInputVal = '';

            // When the add event form is submitted
            jQuery('.js-form-add-event').on('submit', function () {
                $eventInputVal = $eventInput.prop('value'); // Get input value

                // Check if the user entered something
                if ($eventInputVal) {
                    // Add it to the events list
                    jQuery('.js-events')
                        .prepend('<li class="animated fadeInDown">' +
                                jQuery('<div />').text($eventInputVal).html() +
                                '</li>');

                    // Clear input field
                    $eventInput.prop('value', '');

                    // Re-Init Events
                    initEvents();
                }

                return false;
            });
        };

        // Init drag and drop event functionality
        var initEvents = function () {
            jQuery('.js-events')
                .find('li')
                .each(function () {
                    var $event = jQuery(this);

                    // create an Event Object
                    var $eventObject = {
                        title: jQuery.trim($event.text()),
                        color: $event.css('background-color')
                    };

                    // store the Event Object in the DOM element so we can get to it later
                    jQuery(this).data('eventObject', $eventObject);

                    // make the event draggable using jQuery UI
                    jQuery(this).draggable({
                        zIndex: 999,
                        revert: true,
                        revertDuration: 0
                    });
                });
        };

        // Init FullCalendar
        var initCalendar = function () {
            var $date = new Date();
            var $d = $date.getDate();
            var $m = $date.getMonth();
            var $y = $date.getFullYear();
            jQuery('.js-calendar').fullCalendar({
                firstDay: 1,
                editable: true,
                droppable: false,
                header: {
                    left: 'title',
                    right: 'prev,next month,agendaDay'
                },
                drop: function ($date, $allDay) { // this function is called when something is dropped
                    // retrieve the dropped element's stored Event Object
                    var $originalEventObject = jQuery(this).data('eventObject');

                    // we need to copy it, so that multiple events don't have a reference to the same object
                    var $copiedEventObject = jQuery.extend({}, $originalEventObject);

                    // assign it the date that was reported
                    $copiedEventObject.start = $date;

                    // render the event on the calendar
                    // the last `true` argument determines if the event "sticks" (http://arshaw.com/fullcalendar/docs/event_rendering/renderEvent/)
                    jQuery('.js-calendar').fullCalendar('renderEvent', $copiedEventObject, true);

                    // remove the element from the "Draggable Events" list
                    jQuery(this).remove();
                },
                events: eventsarray
            });
        };

        return {
            init: function () {
                // Add Event functionality
                addEvent();

                // FullCalendar, for more examples you can check out http://fullcalendar.io/
                initEvents();
                initCalendar();
            }
        };
    }();

    // Initialize when page loads
    jQuery(function () { BaseCompCalendar.init(); });
</script>

<script>
    function customAlert(message, type) {
        $("#dialog-confirm").dialog({
            resizable: false,
            height: 140,
            width: "auto",
            modal: true,
            buttons: {
                "OK": function () {
                    $(this).dialog("close");
                    switch (type) {
                    }
                },
                Cancel: function () {
                    switch (type) {
                    }
                    $(this).dialog("close");
                }
            },
            open: function (event, ui) {
                $('#dialog-confirm').attr("style", "height: auto; max-height: 62px; min-height: 62px; width: auto;");
                $(".ui-dialog-titlebar").hide();
                $('#dialogContent').text(message);
                if (type === "")
                    $('.ui-dialog-buttonset')[0].children[1].hidden = true;
            }
        });
    }
</script>
<style>
    .fc-time {
        display: none;
    }
</style>